# ARM简介

## 1.ARM的含义

ARM（Advanced RISC Machines）有三种含义，一个公司的名称、一类处理器的通称、一种技术。即ARM既指ARM公司，也指ARM处理器内核。

## 2.ARM公司

- 成立于1990年1月，前身为Acorn计算机公司
- 主要涉及ARM系列RISC处理器内核
- 授权ARM内核给生成和销售半导体的合作伙伴，ARM公司并不生产芯片。即ARM公司设计ARM内核，半导体厂商完善内核周边电路并生产芯片。
- ARM公司是全球领先的半导体知识产权（IP）提供商，全世界超过95%的智能手机和平板电脑都采用ARM架构。

## 3.ARM产品系列

- **早先经典处理器**
  包括ARM7(发展分水岭)，ARM9，ARM11家族
- **Cortex-A系列**
  针对开放式操作系统的高性能处理器，应用于智能手机、数字电视、智能本等高端运用。
- **Cortex-R系列**
  针对于实时系统、满足实时性的控制需求，应于汽车制动系统、动力系统等。
- **Cortex-M系列**
  为单片机驱动的系统提供了低成本优化方案。应用于传统的微控制器市场、智能传感器、汽车周边等。

## 4.RISC处理器

- RISC处理器（ARM处理器，reduced精简指令集）
  	只保留常用的简单指令，硬件结构简单，复杂操作一般通过简单指令的组合实现，一般指令长度固定，且多为单周期指令。
  	RISC处理器在功耗，体积，价格等方面有很大优势，所以在嵌入式移动终端领域应用极为广泛。
- CISC处理器（X86处理器，complex复杂指令集）
      不仅包含了常用指令，还包含了很多不常用的特殊指令，硬件结构复杂，指令条数较多，一般指令长度和周期都不固定。（**复杂指令可能比简单指令周期更长**）
      CISC处理器在性能上有很多优势，多用于PC及服务器等领域。

# STM32简介

## 1.STM32

- STM32是ST公司基于ARM Cortex-M内核开发的32位微控制器。
- STM32常应用在嵌入式领域，如智能车、无人机、机器人、无线通信、物联网、工业控制、娱乐电子产品等。
- STM32功能强大、性能优异、片上资源丰富、功耗低，是一款经典的嵌入式微控制器。![image-20241023180252038](figure\image-20241023180252038.png)

## 2.STM32F1-03C8T6

- 系列：主流系列STM32F1![image-20241023184922207](figure\image-20241023184922207.png)
- 内核：ARM Cortex-M3
- 主频：72MHz
- RAM：20K(SRAM)，运行内存
- ROM：64K（Flash），程序存储介质
- 供电：2.0~3.6V（标准3.3V）
- 封装：LQFP48，(48个引脚)
- ![image-20241023183712331](figure\image-20241023183712331.png)

## 3.片上资源

片上资源也叫外设Peripheral。学习STM32主要就是学习这些外设，通过程序配置这些外设，就能实现我们想要的功能。下图中深颜色的代表处于内核内，其余处于内核外。![image-20241023184154465](figure\image-20241023184154465.png)

## 4.系统结构

![image-20241023185025070](figure\image-20241023185025070.png)

AHB（先进高性能总线），挂载的是一些最基本或者性能比较高的外设，比如复位和时钟控制RRC，SD卡SDIO以及两个桥接。来桥接连接APB2,APB1（先进外设总线），APB2性能一般优于APB1，且一般APB2频率与AHB一样为72MHz一般连接常用的基本的外设，而APB1频率一般为36MHz。

## 5.启动配置

![image-20241023231113151](figure\image-20241023231113151.png)

系统存储器模式就是串口下载程序模式。即启动系统存储器里的BootLoader程序来通过串口下载程序。

SYSCLK的第4个上升沿后，BOOT引脚的功能就变成一般的GPIO的功能了。

# GPIO

## 1.GPIO简介

- GPIO（General Purpose Input Output）通用输入输出口
- 可配置为8种输入输出模式
- 引脚电平：0V~3.3V，部分引脚可容忍5V
- 输出模式下可控制端口输出高低电平，用以驱动LED、控制蜂鸣器、模拟通信协议输出时序等
- 输入模式下可读取端口的高低电平或电压，用于读取按键输入、外接模块电平信号输入、ADC电压采集、模拟通信协议接收数据等

## 2.GPIO基本结构

### GPIO总线结构

![image-20241022110057419](figure\image-20241022110057419.png)

### GPIO位结构

![](figure\image-20241024113202479.png)

## 3.GPIO模式

### 各种模式表

![image-20241024113252747](figure\image-20241024113252747.png)

### GPIO输出模式

![image-20241015151139916](figure\image-20241015151139916.png)

输出高电平+低电平 == 推挽输出，复用推挽

输出低电+浮空/高阻态 == 开漏输出，复用开漏(MO管Q1无效)

### GPIO输出类型比较

- **电路结构**
  开漏输出：通常由一个开关管（如N沟道MOS管）和上拉电阻组成的网络实现，开关管用于控制输出引脚与地的连接状态从而控制输出高低电平，前提是要加一个上拉电阻。
  推挽输出：通常由一个NPN晶体管和一个PNP晶体管（或两个互补型MOSFET）组成。这种结构使得推挽输出既能提供高电平输出，又能提供低电平输出。

- **工作原理**
  开漏输出：当开关管闭合时，输出引脚与地（GND）相连，形成低电平输出。当开关管打开时，输出引脚不与任何电源相连，形成高阻抗状态（浮空状态）。此时需要外部上拉电阻将输出引脚拉高至所需的电压才能形成高电平输出。
  推挽输出：当输入信号为高电平时，NPN晶体管导通，PNP晶体管截止，输出引脚被拉低。当输入信号为低电平时，NPN晶体管截止，PNP晶体管导通，输出引脚被拉高。

- **性能特点**

  开漏输出

  - 输出状态可控：通过控制信号可以切换输出状态。
  - 需要外部上拉电阻：以实现高电平输出。
  - 高电流吸收能力：在输出低电平时具有较强的电流吸收能力。
  - 适用于多路复用：可以与多个设备共享同一输出引脚以及芯片输出电压不足供外部使用时，外部接更高电压的上拉电阻。

  推挽输出：

  - 高输出电流能力：可以直接连接到电源和地，提供较高的输出电流。
  - 低功耗：在静态状态下只需要很小的工作电流。
  - 输出电压稳定：能提供稳定的高电平和低电平输出。
  - 高抗干扰能力：适用于驱动需要抗干扰能力较高的负载。

- **应用场景**

  开漏输出：

  - 当需要多个设备共享同一信号线时，开漏输出是一个很好的选择。它允许设备在不产生冲突的情况下轮流使用信号线，这在I2C、SPI等总线通信协议中尤为常见。因为在数据传输中，设备通过逐位仲裁解决冲突的。比如在主设备发送数据的同时也会读取总线状态，由于开漏具有逻辑与的特征，当检测到总线电平与自身发送位不符（例如自身发的是1，但总线为0），说明主线已被占用，则退出竞争，等待重试。
  - 适用于需要灵活电平控制的场合，如电平匹配、电流驱动等。
  - 当需要控制多个LED灯或其他低功耗负载时，开漏输出可以简化连接，因为它只需要一个外部上拉电阻来提供所需的电压。

  推挽输出：

  - 常用于数字电路中，如微控制器、单片机等电子设备的开关控制功能。
  - 在串口通信等点对点通信场景中，推挽输出通常是一个合适的选择，因为它可以提供稳定的输出电平，确保通信的可靠性。
  - 推挽输出具有较强的驱动能力，可以直接驱动较大的负载电流，因此适用于直接驱动继电器、电机等需要较高电流的负载。

### GPIO输入模式

上拉输入、下拉输入、模拟输入、浮空输入。

上拉和下拉接电阻的原因都是为了让引脚可控。试想一下，如果下列拉不接电阻直接接地，那么外部电压输入时直接把单片机引脚那段链路短路了，电流不会进入单片机引脚直接接地了。如果上拉不接电阻，那么单片机引脚一直是高电平，你外部怎么输入都改变不了单片机引脚状态。

## 4.GPIO与AFIO

GPIO和AFIO都是STM32的片上外设，是相互独立的外设，即虽然GPIO可以配置成AF复用功能，但并不意味着AFIO属于GPIO。其中AFIO拥有自己的外设寄存器，也是属于总线上的一个片上外设。各引脚的输入输出功能，复用功能由GPIO负责，而各引脚的复用功能重映射（可以理解为二次复用）以及复用为中断/事件输出引脚则由AFIO负责。

# OLED显示屏调试

## 1.常用调试方法

- **串口调试**：通过串口通信，将调试信息发送到电脑端，电脑使用串口助手显示调试信息
- **显示屏调试**：直接将显示屏连接到单片机，将调试信息打印在显示屏上
- **Keil调试模式**：借助Keil软件的调试模式，可使用单步运行、设置断点、查看寄存器及变量等功能
- **注释法**
- **对照法**

## 2.OLED简介

OLED（Organic Light Emitting Diode）：有机发光二极管

OLED显示屏：性能优异的新型显示屏，具有功耗低、相应速度快、宽视角、轻薄柔韧等特点

0.96寸OLED模块：小巧玲珑、占用接口少、简单易用，是电子设计中非常常见的显示屏模块

供电：3~5.5V，通信协议：I2C/SPI，分辨率：128*64

## 3.OLED驱动



# EXIT外部中断

## 1.中断系统

### 1.1.中断定义

- **中断**
  在主程序运行过程中，出现了特定的中断触发条件（中断源），使得CPU暂停当前正在运行的程序，转而去处理中断程序，处理完成后又返回原来被暂停的位置继续运行。
- **中断优先级**
  当有多个中断源同时申请中断时，CPU会根据中断源的轻重缓急进行裁决，优先响应更加紧急的中断源。
- **中断嵌套**
  当一个中断程序正在运行时，又有新的更高优先级的中断源申请中断，CPU再次暂停当前中断程序，转而去处理新的中断程序，处理完成后依次进行返回。

### 1.2.中断执行流程

![image-20241022125509854](figure\image-20241022125509854.png)

### 1.3.STM32中断系统

- 68个可屏蔽中断通道（也就是中断源），包含EXTI、TIM、ADC、USART、SPI、I2C、RTC等多个外设中断源，此处针对于STM32F1xxx系列，具体个数以实际芯片为主，具体参考芯片手册9.1的向量表。
- 使用NVIC统一管理中断，每个中断通道都拥有16个可编程的优先等级，可对优先级进行分组，进一步设置抢占优先级和响应优先级。

## 2.NVIC嵌套向量中断控制器

用来统一分配中断优先级和管理中断的，它是内核外设，不是片上外设，可以看作是CPU的小助手，因此可以管理内核中的中断和外设中断。

![image-20241024115059163](figure\image-20241024115059163.png)

- NVIC的中断优先级由优先级寄存器的4位（0~15）决定，这4位可以进行切分，分为高n位的抢占优先级和低4-n位的响应优先级。
- 抢占优先级高的可以中断嵌套，响应优先级高的可以优先排队即插队，抢占优先级和响应优先级均相同的按中断号排队。![image-20250130155353002](figure\image-20250130155353002.png)

## 3.EXIT外部中断

EXTI（External Interrupt/Event Controller）即外部中断/事件控制器（事件与中断不同，其产生的信号不发送给CPU，而是发送给其他外设，用来开启、驱动、控制其他外设），是STM32等微控制器中用于监测指定GPIO引脚电平变化的外设。当GPIO引脚的电平发生上升沿、下降沿或双边沿变化时，EXTI会向NVIC（嵌套中断向量控制器）发出中断请求，经过NVIC裁决后，CPU会暂停当前主程序，转而执行EXTI对应的中断服务函数。总结来说，EXTI中断主要用于监测GPIO引脚的电平变化，适用于需要快速响应外部信号变化的场景；而其他片上外设中断如ADC中断主要用于模数转换完成后的数据处理，适用于模拟信号采集的场景；USART中断则用于串行通信中的数据发送和接收，适用于串行通信的场景。因此EXIT外部中断的外部指的是通过GPIO引脚连接的MCU之外的设备，而并非片上外设。

- **EXTI中断**需要通过配置GPIO引脚和EXIT相关寄存器来检测外部信号的变化，从而产生中断信号。
- **ADC、USART等外设中断**则是由硬件内部事件自动触发，不需要外部信号输入，用户只需配置外设的相关寄存器

### 整体结构

![image-20241024123701173](figure\image-20241024123701173.png)

### AFIO复用IO口

- AFIO主要用于引脚复用功能的选择和重定义。
- 在STM32中，AFIO主要完成两个任务：复用功能引脚**重映射**、**中断引脚选择**。![image-20241024123459351](figure\image-20241024123459351.png)

### EXIT内部电路结构

![image-20241024123635410](figure\image-20241024123635410.png)

## 4.编码步骤

1. 开启片上外设时钟，内核外设和CPU一样一直运行着，况且RCC外设管不着内核外设，故不需要开启时钟。

2. 初始化GPIO引脚，配置GPIO外设。

3. AFIO复用引脚为中断功能，配置AFIO外设。

4. 配置EXIT寄存器，配置上升沿下降沿触发选择寄存器来选择上升沿还是下降沿触发中断，配置事件/中断屏蔽寄存器来使能或失能中断。

5. 配置NVIC，使能相应的中断通道，以及为整个系统的中断进行优先级分组并设置优先级。

6. 编写中断函数，中断函数名在中断向量表中有，更加NVIC配置的中断通道，选择对应得中断函数，函数参数和返回值都是Void类型。

   注：当发送中断时，外设的状态寄存器中的中断标志位会被置1，然后向CPU申请中断处理，而该位需要在中断程序里手动清0，不会自动变为0，而是一直是1，不手动清除的化会一直向CPU申请中断。

## 5.中断总结

对于STM32的200多个中断分为68个中断通道全都要进入到NVIC里归NVIC中断控制器管理。对于外部中断EXIT的中断需要配置EXIT寄存器，因为GPIO引脚输入到单片机的只是高低电平上升沿下降沿，并非中断，而要通过EXIT来产生中断，而对于其他内部中断如定时器，USART等中断它们是能够直接产生中断的，故配置方法又是另外一种。总之，就是NVIC必须配置，其他的要根据其自己是否能产生中断，不能自己产生的则借助EXIT来产生中断。

因此，对于其他外设，只需要使能外设中断输出（**ITConfig(TIM2,ENABLE)**），再配置内核外设NVIC即可。

# TIM定时器

## 1.TIM简介

- TIM（Timer）定时器
- 定时器可以对输入的时钟进行计数，并在计数值达到设定值时触发中断
- 16位计数器（每来一个时钟信号，计数器加1）、预分频器、自动重装寄存器的时基单元，在72MHz计数时钟下可以实现最大59.65s的定时
- 不仅具备基本的定时中断功能，而且还包含内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等多种功能
- 根据复杂度和应用场景分为了高级定时器、通用定时器、基本定时器三种类型

## 2.基本定时器

### 框图

![image-20250130193645656](figure\image-20250130193645656.png)

图中最下面的注释，代表该寄存器有影子寄存器（也叫缓冲寄存器），该寄存器由两个寄存器组成，一个是预装载寄存器，也就是实际进行读写的寄存器，另外一个就是用于实际进行计数溢出值比较的实际寄存器，也就是影子寄存器或者缓冲寄存器。

假设使能了自动重装寄存器的预装载使能位，则预装载寄存器是我们实际读写的寄存器，当一个往该寄存器写入新的数据后，如果计数器还没达到溢出值产生更新事件，则缓冲寄存器里的值还是旧值，只有当更新事件产生时。才把预装载寄存器的新值传给缓冲寄存器，然后计数器的溢出值更新为该新值。

对于触发控制器，当关闭主/从模式时，该寄存器可以直接看成一个选择外部时钟源作为CK_PSC的简单寄存器，但此处的时钟源只有一个。而TRGO（triger output）可以直接忽略不看。

### 时钟源

时钟源只能是内部时钟。

### 应用场景

定时器定时中断

## 3.通用定时器

### 框图

![image-20250204205410743](figure\image-20250204205410743.png)

### 时钟源

● 内部时钟(CK_INT) ，内部晶振时钟

● 外部时钟模式1：外部输入脚(TIx) ，输入捕获时钟

● 外部时钟模式2：外部触发输入(ETR) ，外部晶振时钟

● 内部触发输入(ITRx)：使用一个定时器作为另一个定时器的预分频器，如可以配置一个定时器Timer1而作为另一个定时器Timer2的预分频器，也叫做定时器级联。

### 应用场景

定时器外部时钟

## 4.TIM输出比较（PWM）

### 相关概念

输出比较可以通过比较CNT与CCR寄存器值的关系，来对输出电平进行置1，置0或翻转的操作，用于输出一定的频率和占空比的PWM波形。

每个高级定时器和通用定时器都拥有4各输出比较通道。

PWM，脉冲宽度调整，在具有惯性的系统中，可以通过对一些列脉冲的宽度进行调制，来等效地获得所需要的模拟参量，常应用于电机控速等领域。正是需要惯性，如电灯灭了后不会立刻熄灭掉，而是会稍微延迟一会再灭，这样当输出PWM波形时人的肉眼就无非察觉到灭了的现象。

PWM参数：频率=1/Ts 占空比=Ton /T s 分辨率=占空比变化步距。

### 通用定时器输出/比较框图

![image-20250205195114609](figure\image-20250205195114609.png)

### CNT与CCR的关系图

![image-20250205195454263](figure\image-20250205195454263.png)

### 参数计算

PWM频率：Freq = CK_PSC/(PSC+1)/(ARR+1)

PWM占空比：Duty = CCR / （ARR+1）

PWM分辨率：Reso = 1/（ARR+1）

## 5.输入捕获

# ——通信协议——

​	通信协议，是通信双方已经约定好了的一种对通信数据格式的构成。

​	在嵌入式中，通信协议主要分为两大类，一种是位于应用层的专门处理上层的通信协议，这类协议主要是定义通信数据的帧格式等；而另外一类是位于底层专门处理物理层的通信协议，这类协议主要是定义上层通信数据包的每个字节数据在物理介质上通信的电平时序。而学习单片机，学习的通信协议正是位于底层的物理层的协议，且固定的就那么常见的几种，如USART,IIC,SPI等。而对于应用层的规定数据帧，数据包的格式那就很多，并不固定，如OSI七层模型中的ip，tcp协议，物联网的MQTT协议等。但大家都有通信帧，因此处理方式很相似，只不过应用层通信帧需要软件处理帧字段，而底层通信帧由硬件自动处理帧字段，当想利用软件模拟底层通信协议时，可以像应用层通信帧一样，帧字段独自分开处理，进行组帧解帧。**就像得出帧各个字段内容再组帧成不同的帧进行通信一样，软件模拟的也是先模拟出各个字段的高低电平变化，再组成不同的时序进行通信。**

​	物理层的通信协议主要定义了通信的电气特性（电平标准、波特率等）、引脚的定义等其通信数据帧(包含的帧字段多为**起始位，数据位，停止位**)由硬件自动产生，是软件与硬件的高度结合，而物理层之上的主要定义的是数据包的格式，传输规则等，其数据帧的组帧解帧由软件完成，是纯软件编程。而本章的通信协议就是针对于硬件物理层的通信协议，即单片机的通信协议。

## 1.NRZ编码

即不归零编码，只有高电平和低电平状态，没有零电平状态。具体参考[工业标准 NRZ异步串行数据传输格式_nrz格式-CSDN博客](https://blog.csdn.net/qq_27485531/article/details/86560097)

## 2.通信接口

#### 通信的目的

​	将一个设备的数据传送到另一个设备，扩展硬件系统。因为对于GPIO,ADC那些外设（外设无非就是一些控制寄存器，状态寄存器，数据寄存器再加上一些外设特有的寄存器等组成的集合），是CPU能够直接控制的，属于一级外设，而对于其他不处于芯片上的外设，需要通过通信接口来连接进行通信，因此属于二级外设。正是这些二级外设才扩展了MCU的硬件系统。

#### 通信协议

​	制定通信的规则，通信双方按照协议规则进行数据收发。

#### 各种协议比较

![image-20250129102834601](figure\image-20250129102834601.png)

同步靠时钟线，异步靠比特率。

# USART

## 1.串口通信

- 串口是一种应用十分广泛的通讯接口，串口成本低、容易使用、通信线路简单，可实现两个设备的互相通信。
- 单片机的串口可以使单片机与单片机、单片机与电脑、单片机与各式各样的模块互相通信，极大地扩展了单片机的应用范围，增强了单片机系统的硬件实力。

## 2.硬件电路

- 简单双向串口通信有两根通信线（发送端TX和接收端RX）
- TX与RX要交叉连接
- 当只需单向的数据传输时，可以只接一根通信线
- 当电平标准不一致时，需要加电平转换芯片

## 3.电平标准

- 电平标准是数据1和数据0的表达方式，是传输线缆中人为规定的电压与数据的对应关系
- TTL电平：+3.3V或+5V表示1，0V表示0
- RS232电平：-3~-15V表示1，+3~+15V表示0
- RS485电平：两线压差+2~+6V表示1，-2~-6V表示0（差分信号）

因为控制器一般使用TTL电平标准，所以常常会使用MAX232芯片对TTL及RS-232电平的信号进行互相转换。

## 4.串口参数及时序

​	串口通信帧的时序波形由硬件自动产生，我们只需要往数据寄存器里放或者读想要发送和传送的数据即可，硬件会自动根据寄存器中的数据发出响应的电平信号，或者解析电平信号获得相应的数据。

- 波特率：串口通信的速率，码元传输的速率，不是比特传输的速率
- 起始位：标志一个数据帧的开始，固定为低电平
- 数据位：数据帧的有效载荷，1为高电平，0为低电平，低位先行
- 校验位：用于数据验证，根据数据位计算得来
- 停止位：用于数据帧间隔，固定为高电平

​	串口中，每一个字节都装载在一个数据帧里面，每个数据帧都由**起始位**、**数据位**和**停止位**组成。起始位固定为0，产生下降沿，表示传输开始；停止位固定为1，把引脚恢复成高电平，方便下一次的下降沿，如果没有数据了，正好引脚也为高电平，代表空闲状态。

时序：空闲状态==高电平、起始位==低电平、数据位、停止位==高电平

![image-20250129174029631](figure\image-20250129174029631.png)

## 5.STM32的USART

- USART（Universal Synchronous/Asynchronous Receiver/Transmitter）通用同步/异步收发器
- USART是STM32内部集成的硬件外设，可根据数据寄存器的一个字节数据自动生成数据帧时序，从TX引脚发送出去，也可自动接收RX引脚的数据帧时序，拼接为一个字节数据，存放在数据寄存器里
- 自带波特率发生器，最高达4.5Mbits/s
- 可配置数据位长度（8/9）、停止位长度（0.5/1/1.5/2）
- 可选校验位（无校验/奇校验/偶校验）
- 支持同步模式、硬件流控制（流控一般用于发送方发太快，接收方处理不过来的情况）、DMA、智能卡、IrDA、LIN
- USART框图具体参考STM32参考手册

## 6.重定向打印到串口

- 修改printf函数底层函数fputc函数
- 先用sprintf把格式化输出输出到一个字符串，再把字符串发送到串口
- 利用可变参数的vsprintf

## 7.MicroLib

### 1.介绍

MicroLib是一个针对嵌入式系统的高度优化的C标准库，专为基于ARM的嵌入式应用程序设计。它旨在为资源受限的嵌入式设备提供更小的代码尺寸和更低的内存占用。与ARM编译器工具链中包含的标准C库相比，MicroLib 具有以下特点：

1. **代码尺寸优化**：MicroLib经过高度优化，显著减少了代码和数据内存的占用。
2. **功能精简**：它不支持某些ISO C特性、文件I/O、宽字符或多字节字符串。
3. **运行速度**：某些函数（如 `memcpy()`）的执行速度可能比标准C库慢。
4. **操作系统支持**：MicroLib不依赖操作系统，但可以与RTOS（如 Keil RTX）一起使用。
5. **浮点运算**：不支持IEEE 754二进制浮点算法标准。
6. **内存模型**：仅提供双区内存模型（单独的堆栈和堆区）。

### 2.使用场景

- **嵌入式开发**：适用于内存受限的深度嵌入式应用程序。
- **串口输出**：支持将 `printf()` 等标准输出函数重定向到串口。
- **与 RTOS 集成**：可以与实时操作系统一起使用，但不支持某些操作系统函数。

### 3.注意事项

- **不支持 C++**：MicroLib 不支持 C++ 开发。
- **浮点运算问题**：在有 FPU 单元的 MCU 上，使用 MicroLib 并开启 FPU 可能会导致程序异常。

MicroLib 是一个强大的工具，尤其适用于对代码大小和内存占用有严格要求的嵌入式项目。

# IIC

## 1.IIC通信

- I2C（Inter IC Bus）是由Philips公司开发的一种通用数据总线
- 两根通信线：SCL（Serial Clock）、SDA（Serial Data）
- 同步，半双工
- 带数据应答
- 支持总线挂载多设备（一主多从、多主多从），其中一主多从是只能有一个主机，而多主多从允许有多个主机，当多个主机都发起通信时，总线需要进行仲裁。

## 2.硬件电路

- 所有I2C设备的SCL连在一起，SDA连在一起
- 形象比如：弱上拉，连接弹簧的棍子。
- 设备的SCL和SDA**均要配置成开漏输出模式**（由于输入可以是任何时候都有的，无需配置，因此主机的SDA或SCLK引脚一直处于接收状态，而当主机进行数据发送拉高拉低SDA时，因为开漏输出的“与”特性，主机拉高拉低，从机也会跟着拉高拉低，因而从机也就能接收到高低电平，同样，从机应答时，拉高拉低，主机也能直接感受到是拉高还是拉低，这样就只需要控制一个开关就能很容易的进行输入和输出的切换）
  ![image-20250311202717747](figure\image-20250311202717747.png)
- SCL和SDA各添加一个上拉电阻，阻值一般为4.7KΩ左右
  ![image-20250311202705086](figure\image-20250311202705086.png)

## 3.时序基本单元

- 起始和终止的特殊性：SDA在SCL高电平期间变化，特殊于数据每一位在SCL高电平期间得保持电平不变得特性。
- 起始条件：SCL高电平期间，SDA从高电平切换到低电平
- 终止条件：SCL高电平期间，SDA从低电平切换到高电平
- ![image-20250311204814096](figure\image-20250311204814096.png)
- 发送一个字节：SCL低电平期间，主机将数据位依次放到SDA线上（**高位先行**），然后释放SCL，从机将在SCL高电平期间读取数据位，所以SCL高电平期间SDA不允许有数据变化，依次循环上述过程8次，即可发送一个字节
- 接收一个字节：SCL低电平期间，从机将数据位依次放到SDA线上（高位先行），然后释放SCL，主机将在SCL高电平期间读取数据位，所以SCL高电平期间SDA不允许有数据变化，依次循环上述过程8次，即可接收一个字节（主机在接收之前，需要释放SDA）
- 发送应答：主机在接收完一个字节之后，在下一个时钟发送一位数据，数据0表示应答，数据1表示非应答
- 接收应答：主机在发送完一个字节之后，在下一个时钟接收一位数据，判断从机是否应答，数据0表示应答，数据1表示非应答（主机在接收之前，需要释放SDA）

## 4.IIC时序

### 1.指定地址写

对于指定设备（Slave Address），在指定地址（Reg Address）下，写入指定数据（Data）

### ![image-20250315223037389](figure\image-20250315223037389.png)2.指定地址读

对于指定设备（Slave Address），在指定地址（Reg Address）下，读取从机数据（Data）

### ![image-20250315223225450](figure\image-20250315223225450.png)3.当前地址读

对于指定设备（Slave Address），在当前地址指针指示的地址下，读取从机数据（Data）。对于未指定地址的情况，有些IIC从机的地址寄存器会在每次读出或写入一个数据时自动加一，因为读出或写入的数据的位置是当前地址寄存器所指向的位置。

![image-20250315223409679](figure\00_开发常用命令.md)

# SPI

# CAN

# USB