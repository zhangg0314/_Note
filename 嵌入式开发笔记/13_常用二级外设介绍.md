## ——IIC——

# MPU6050

## 1.简介

- MPU6050是一个6轴姿态传感器，可以测量芯片自身X、Y、Z轴的加速度、角速度参数，通过数据融合，可进一步得到姿态角，常应用于平衡车、飞行器等需要检测自身姿态的场景
- 3轴加速度计（Accelerometer）：测量X、Y、Z轴的加速度
- 3轴陀螺仪传感器（Gyroscope）：测量X、Y、Z轴的角速度
- 9轴姿态传感器：6轴+三轴磁场力
- 10轴姿态传感器：9轴+气压

## 2.参数

- 16位ADC采集传感器的模拟信号，量化范围：-32768~32767（由于各个传感器的本质都是滑动变阻器，最终输出是电压值，因此通过ADC采集电压值再存往数据寄存器）
- 加速度计满量程选择：±2、±4、±8、±16（g）
- 陀螺仪满量程选择： ±250、±500、±1000、±2000（°/sec）
- 可配置的数字低通滤波器
- 可配置的时钟源
- 可配置的采样分频
- I2C从机地址：1101000（AD0=0）、1101001（AD0=1）

## 3.电路框图

![image-20250315224728481](figure\image-20250315224728481.png)

- CLKIN和CLKOUT引脚接的是外部晶振，即当系统时钟源选外部时钟时利用这两个引脚。
- AUX_CL、AUX_DA为辅助的IIC引脚，即当MPU6050需要作为IIC主机获取其他外设的数据时可以接这两个引脚，当然这两个引脚也可一起接到挂在到主IIC的SDA和SCL上，使得其他外设芯片和MPU6050一起做STM32IIC通信的从机。
- Self test：自我测试，先失能自我测试功能，测取传感器的值，再使能测试功能，测试功能会相当于给MPU6050施加了外力一样，使得测试的数据比正常情况下还大。然后两者相减，如果所得差值在芯片手册规定的误差范围内，则说明芯片能正常工作。

# LCD1602

## 1.显示特性

- 单 5V 电源电压，低功耗、长寿命、高可靠性
- 内置 192 种字符（160 个5×7 点阵字符和32 个5×10 点阵字符）
- 具有 64 个字节的自定义字符RAM，可自定义8 个5×8 点阵字符或四个5×11 点阵字符
- 显示方式：STN、半透、正显
- 背光方式：底部 LED
- 通讯方式：4 位或8 位并口可选
- 标准的接口特性，适配 MC51 和M6800 系列MPU 的操作时序。

## 2.显示原理

### 1.像素点阵

8\*5的像素点阵，其中一个**字符点阵为7\*5点阵**，而光标占一行**1*5**。其中每一个像素是一块液晶，当在上面施加电压时，其就不会i透光，形成一个黑点，这个黑点就是像素点，而众多的字符就是由这一个个的像素点组成。当对于每一个液晶不可能单独接一个MCU的引脚来控制，因此需要用到MPU如HD44780U、PCF8574来控制像素点。这个MPU类似于显卡，它的引脚很多，可以对应很多像素。

### 2.在哪显示(&DDRAM)

![image-20250322130229370](figure\image-20250322130229370.png)

**DDRAM（显示数据寄存器）是一个以字节为单位的存储器**。其中DDRAM的每个字节中存储显示字符的字符码，其容量的大小决定着模块最多可显示的字符数目。LCD中只设置了80个字节的DDRAM，而每个字节正好可以存一个字符的ASCII码，所以LCD可以同时控制80个字符。

能显示在这款LCD上的只有32个字符，而剩下字节数的DDRAM是用不到的。字符的存放位置就是DDRAM的地址，上图给出的就是字符显示位置与DDRAM地址对应的关系。因此要在某个位置显示一个字符，需要先传入DDRAM的地址（由地址计数器AC指向其地址，也就是给AC写入数据，写的是DDRAM的地址），然后再写入数据到DDRAM中即可。【先写DDRAM地址，再写DDRAM内容】

### 3.怎么显示（CGROM、CGRAM）

**CGROM和CGRAM**（字符生成寄存器）也是以字节为单位的存储器。其中一个字节单位存储着一个字符点阵的一行，也就是1 * 5个像素点的电压二进制值，且该字节的高三位固定为0，因此对于一个5 * 8的字符点阵，需要8 * 8位也就是8个字节的CGROM来存下一个完整的字符点阵的信息，而对于5 * 10的字符点阵，需要8 * 16位也就是16个字节的CGROM来存下一个完整的字符点阵信息。

而CGROM地址是12位，其中高8位地址就是对应要显示的字符的ASCII码，而低4位就是对应着每个字符点阵的每一行像素的地址即行地址。就单屏结构的模块而言，字符码地址范围为00H~FFH，其中00H~07H 字符码与用户在CGRAM 中生成的自定义图形字符的字模组（字模组就是一行一行的像素点组成的，本质就是8 * 8的矩阵位图，也就是对应8个字节）相对应,其中CGRAM的地址是6位。

数据引脚8根线，对应字符数据为8位，因此可以显示256个字符，也就是说对应的CGROM的地址有256 个，而CGROM中存放了字符库，根据CGROM的地址正好可以给出对应的字符到DDRAM中去。

但此LED1602中有160 * 16个字节来存160个5 * 8的字符,32 * 16个字节来存32个 5 * 10的字符，而剩下的CGOM为4 * 16个字节可以存8个 5 * 8的或 4个 5 * 10的。![image-20250323092700179](D:\01_Document\01_嵌入式笔记\-\嵌入式开发笔记\figure\image-20250323092700179.png)
**注释：**
􀂗 高八位 CGROM 地址A11~A4 组合形成字符码；
􀂗 低四位 CGROM 地址A3~A0 定义字模数据存储行地址；
􀂗 数据 O4~O0 为字符字模数据；
􀂗 必须将高三位数据 O5~O7 赋值为0；
􀂗 对应数据 1 的位置为显示位（黑）；
􀂗 对于 5X8 点阵字体，第九行以下（包括第九行)数据应赋值为0；

### 4.字符库

在LCD1602的手册中给出了这样一个表格，我们想显示表格中的字符只需获取某个字符的高位和低位即可。例如我想显示“B”这个字符，就是0100 0010转换成16进制就是0x42，刚好对应‘B’的ASCLL码66。当然我们在编程的时候无需这样操作，只需输入字符即可，编译器会自动编译成对应的ASCLL码。这些数据的二进制表示的是CGROM的地址的高八位，而CGROM中存放了字符库，每字节的CGROM存的是字符点阵的每一行像素值。
![image-20250322130420643](figure\image-20250322130420643.png)

说到这里会发现无论是传输地址的指令还是传输字符的指令都是通过D0-D7这八根线进行传输，那么我们什么时候传输的数据，什么时候传输的是地址呢。我们靠的是在1602上的RS引脚，RS为高电平1时选择数据寄存器（写数据）、低电平0时选择指令寄存器（写地址）。

### 4.总结

液晶显示模块是一个慢显示器件，所以在执行每条指令之前一定要确认模块的忙标志为低电平，表示LCD此时不忙，这时才能写指令和数据，否则此指令失效。要显示字符时要先输入显示字符地址**(写指令)**，也就是告诉模块在，哪里显示字符，然后再写入需要显示的字符**(写数据)**，才能够正常显示字符。

## 3.结构块图

40*2个SEG控制16 *5个像素点，16个COM控制16个像素点，正好对应16 * 2 个8 * 5的像素点。LCD 显示屏为common 和 segment 交叉形成的点阵，以5×8 点阵的字符结构模式和设置的显示字符数目。在控制器的控制下，模块通过数据总线DB0~DB7 和E、R/W、RS 三个输入控制端与MPU 接口。这三根控制线按照规定的时序相互协调作用，使控制器通过数据总线DB接收MPU发送来的指令和数据，从CGROM（CGROM的地址就是字符的ASCII编码）中找到欲显示字符的字符码，送入DDRAM（DDRAM的地址就是LED显示屏的位置。DDRAM的数据就是common和segment要交叉形成的点阵），在LCD 显示屏上与DDRAM 存储单元对应的规定位置显示出该字符。控制器还可以根据MPU 的指令，实现字符的显示、闪烁和移位等显示效果。

![image-20250322211224605](figure\image-20250322211224605.png)

## 4.接线说明

| 管脚号 | 符号 | 说明                                                         |
| ------ | ---- | ------------------------------------------------------------ |
| 1      | VSS  | GND                                                          |
| 2      | VDD  | +5V                                                          |
| 3      | V0   |                                                              |
| 4      | RS   | RS=0，当MPU 进行写模块操作，指向指令寄存器；当 MPU 进行读模块操作，指向地址计数器。<br/>RS=1，无论MPU 读操作还是写操作，均指向数据寄存器。 |
| 5      | R/W  | R/W=0 写操作；R/W=1 读操作                                   |
| 6      | E    | 读操作时，高电平有效；写操作时，下降沿有效                   |
| 7      | D0   | 数据输入/输出口，MPU 与模块之间的数据传送通道。4 位方式通讯时，不使用DB0-DB3 |
| 8      | D1   | 数据输入/输出口，MPU 与模块之间的数据传送通道。4 位方式通讯时，不使用DB0-DB3 |
| 9      | D2   | 数据输入/输出口，MPU 与模块之间的数据传送通道。4 位方式通讯时，不使用DB0-DB3 |
| 10     | D3   | 数据输入/输出口，MPU 与模块之间的数据传送通道。4 位方式通讯时，不使用DB0-DB3 |
| 11     | D4   | 数据输入/输出口，MPU 与模块之间的数据传送通道                |
| 12     | D5   | 数据输入/输出口，MPU 与模块之间的数据传送通道                |
| 13     | D6   | 数据输入/输出口，MPU 与模块之间的数据传送通道                |
| 14     | D7   | 数据输入/输出口，MPU 与模块之间的数据传送通道                |
| 15     | A    | 背光的正端+5V                                                |
| 16     | K    | 背光的正端0V                                                 |

## 5.LCD读写操作

LCD1602分为读操作和写操作，其中读操作可以分为读数据地址和读数据，写操作可以分为写数据地址和写数据。

- 读地址： 读取LCD引脚状态，返回为状态字，D0-D6为当前LCD数据指针的地址 D7为是否允许读写操作(即检查LCD是否处于忙状态)

- 读数据：读取D0-07内的数据

- 写指令/地址： 写入LCD的控制指令，比如清屏，显示开关等或者写入要显示数据的地址

- 写数据： 写入需要显示的数据，比方说要显示字符a，就写入0100 0001（41H） 

## 6.总结

**也就是说，对于读写数据，都是要先给的数据存放的位置，因此读写数据之前要先进行写地址操作；而对于其他指令来说，直接写寄存器就可以了**。即写指令可以理解为写寄存器地址和写指令，而读指令只有读地址。像MPU6050一样，读写数据之前，都要先写入一个地址告诉数据存放的位置，而与之不同的是，对于一些操作指令如清屏等是直接有数据+写指令控制位组成写一次就够了的。

## 7.内部指令

![image-20250322134209624](figure\image-20250322134209624.png)

## 8.参考链接

原文链接：https://blog.csdn.net/aaaaaaaa123345/article/details/124212417

[【常用传感器】LCD1602液晶工作原理详解及例程代码_lcd1602工作原理-CSDN博客](https://blog.csdn.net/as480133937/article/details/113148712)

# PCF8574

PCF8574是CMOS电路。它通过两条双向总线(I2C)可使大多数MCU**实现远程I/O口扩展**。该器件包含一个8位准双向口和一个12c总线接口。PCF8574电流消耗很低，且口输出锁存具有大电流驱动能力，可直接驱动LED。它还带有一条中断接线(INT)可与MCU的中断逻辑相连，通过INT发送中断信号，远端I/0口不必经过I2C总线通信就可通知MCU是否有数据从端口输入。这意味蓿PCF8574可以作为一个单被控器。PCF8574和PCF8574A的唯一区别仅在于器件地址不相同。

### 1.功能框图

![image-20250322135902313](figure\image-20250322135902313.png)

# ——SPI——

# W25Q64

## 1.W25Q64简介

- W25Qxx系列是一种低成本、小型化、使用简单的非易失性存储器，常应用于数据存储、字库存储、固件程序存储等场景

- 存储介质：Nor Flash（闪存）

- 时钟频率：80MHz / 160MHz (Dual SPI) / 320MHz (Quad SPI)

- 存储容量（24位地址），三个字节地址

  | 型号    | 容量              |
  | ------- | ----------------- |
  | W25Q40  | 4Mbit / 512KByte  |
  | W25Q80  | 8Mbit / 1MByte    |
  | W25Q16  | 16Mbit / 2MByte   |
  | W25Q32  | 32Mbit / 4MByte   |
  | W25Q64  | 64Mbit / 8MByte   |
  | W25Q128 | 128Mbit / 16MByte |
  | W25Q256 | 256Mbit / 32MByte |

## 2.硬件电路

### 1.芯片图

![image-20250330171225156](figure\image-20250330171225156.png)

### 2.模块封装图

![image-20250330171034523](figure\image-20250330171034523.png)

### 3.引脚介绍

| 引脚     | 功能              |
| -------- | ----------------- |
| VCC、GND | 电压（2.7V~3.6V） |
| CS(SS)   | 片选              |
| CLK(SCK) | SPI时钟           |
| DI(MOSI) | 主机输出从机输入  |
| DO(MISO) | 主机输入从机输出  |
| WP       | 写保护            |
| HOLD     | 数据保持          |

## 3.W25Q64框图

![image-20250330171726785](figure\image-20250330171726785.png)

整个8MB（0x000000~0x7FFFFF）的存储空间，划分成了128块（Block），每块大小64KB（0xXX0000~0xXXFFFF）。每一块又被划分为了16个扇区，每个扇区4KB(0xXXX000~0xXXXFFF)。

实际上存储时的读写单位是按页进行的，页可以看成对整个空间划分，也可以看成对扇区更小的划分，一个页是256字节（0xXXXX00~0xXXXXFF），因此一个扇区里有16页。

## 4.Flash操作注意事项

### 1.写入操作时

- 写入操作前，必须先进行写使能
- 每个数据位只能由1改写为0，不能由0改写为1
- 写入数据前必须先擦除，擦除后，所有数据位变为1
- 擦除必须按最小擦除单元（一个扇区）进行（因此也算一个缺点，所有对于要存大量参数的项目应该选中EEPROM）
- 连续写入多字节时，最多写入一页的数据，超过页尾位置的数据，会回到页首覆盖写入（256Byte页缓冲区的存在）
- 写入操作结束后，芯片进入忙状态，不响应新的读写操作

### 2.读取操作时

直接调用读取时序，无需使能，无需额外操作，没有页的限制，读取操作结束后不会进入忙状态，但不能在忙状态时读取

## 5.芯片手册

参考芯片手册PDF文件进一步了解。
