# ARM简介

## ARM的含义

ARM（Advanced RISC Machines）有三种含义，一个公司的名称、一类处理器的通称、一种技术。即ARM既指ARM公司，也指ARM处理器内核。

## ARM公司

- 成立于1990年1月，前身为Acorn计算机公司
- 主要涉及ARM系列RISC处理器内核
- 授权ARM内核给生成和销售半导体的合作伙伴，ARM公司并不生产芯片。即ARM公司设计ARM内核，半导体厂商完善内核周边电路并生产芯片。
- ARM公司是全球领先的半导体知识产权（IP）提供商，全世界超过95%的智能手机和平板电脑都采用ARM架构。

## ARM产品系列

- **早先经典处理器**
  包括ARM7(发展分水岭)，ARM9，ARM11家族
- **Cortex-A系列**
  针对开放式操作系统的高性能处理器，应用于智能手机、数字电视、智能本等高端运用。
- **Cortex-R系列**
  针对于实时系统、满足实时性的控制需求，应于汽车制动系统、动力系统等。
- **Cortex-M系列**
  为单片机驱动的系统提供了低成本优化方案。应用于传统的微控制器市场、智能传感器、汽车周边等。

## RISC处理器

- RISC处理器（ARM处理器，reduced精简指令集）
  	只保留常用的简单指令，硬件结构简单，复杂操作一般通过简单指令的组合实现，一般指令长度固定，且多为单周期指令。
  	RISC处理器在功耗，体积，价格等方面有很大优势，所以在嵌入式移动终端领域应用极为广泛。
- CISC处理器（X86处理器，complex复杂指令集）
      不仅包含了常用指令，还包含了很多不常用的特殊指令，硬件结构复杂，指令条数较多，一般指令长度和周期都不固定。（**复杂指令可能比简单指令周期更长**）
      CISC处理器在性能上有很多优势，多用于PC及服务器等领域。

# STM32简介

## STM32

- STM32是ST公司基于ARM Cortex-M内核开发的32位微控制器。
- STM32常应用在嵌入式领域，如智能车、无人机、机器人、无线通信、物联网、工业控制、娱乐电子产品等。
- STM32功能强大、性能优异、片上资源丰富、功耗低，是一款经典的嵌入式微控制器。![image-20241023180252038](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241023180252038.png)

## STM32F1-03C8T6

- 系列：主流系列STM32F1![image-20241023184922207](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241023184922207.png)
- 内核：ARM Cortex-M3
- 主频：72MHz
- RAM：20K(SRAM)，运行内存
- ROM：64K（Flash），程序存储介质
- 供电：2.0~3.6V（标准3.3V）
- 封装：LQFP48，(48个引脚)![image-20241023183712331](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241023183712331.png)

## 片上资源

片上资源也叫外设Peripheral。学习STM32主要就是学习这些外设，通过程序配置这些外设，就能实现我们想要的功能。下图中深颜色的代表处于内核内，其余处于内核外。![image-20241023184154465](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241023184154465.png)

## 系统结构

![image-20241023185025070](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241023185025070.png)

AHB（先进高性能总线），挂载的是一些最基本或者性能比较高的外设，比如复位和时钟控制RRC，SD卡SDIO以及两个桥接。来桥接连接APB2,APB1（先进外设总线），APB2性能一般优于APB1，且一般APB2频率与AHB一样为72MHz一般连接常用的基本的外设，而APB1频率一般为36MHz。

## 启动配置

![image-20241023231113151](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241023231113151.png)

系统存储器模式就是串口下载程序模式。即启动系统存储器里的BootLoader程序来通过串口下载程序。

SYSCLK的第4个上升沿后，BOOT引脚的功能就变成一般的GPIO的功能了。

# GPIO

## GPIO简介

- GPIO（General Purpose Input Output）通用输入输出口
- 可配置为8种输入输出模式
- 引脚电平：0V~3.3V，部分引脚可容忍5V
- 输出模式下可控制端口输出高低电平，用以驱动LED、控制蜂鸣器、模拟通信协议输出时序等
- 输入模式下可读取端口的高低电平或电压，用于读取按键输入、外接模块电平信号输入、ADC电压采集、模拟通信协议接收数据等

## GPIO基本结构

### GPIO总线结构

![image-20241022110057419](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241022110057419.png)

### GPIO位结构

![image-20241024113202479](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241024113202479.png)

## GPIO模式![image-20241024113252747](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241024113252747.png)

### GPIO输出

![image-20241015151139916](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241015151139916.png)

输出高电平+低电平 == 推挽输出，复用推挽

输出低电+浮空/高阻态 == 开漏输出，复用开漏

### GPIO输出类型比较

- **电路结构**：
  开漏输出：通常由一个开关管（如N沟道MOS管）和上拉电阻组成的网络实现，开关管用于控制输出引脚与地的连接状态。
  推挽输出：通常由一个NPN晶体管和一个PNP晶体管（或两个互补型MOSFET）组成。这种结构使得推挽输出既能提供高电平输出，又能提供低电平输出。

- **工作原理**：
  开漏输出：当开关管闭合时，输出引脚与地（GND）相连，形成低电平输出。当开关管打开时，输出引脚不与任何电源相连，形成高阻抗状态（浮空状态）。此时需要外部上拉电阻将输出引脚拉高至所需的电压。
  推挽输出：当输入信号为高电平时，NPN晶体管导通，PNP晶体管截止，输出引脚被拉低。当输入信号为低电平时，NPN晶体管截止，PNP晶体管导通，输出引脚被拉高。

- **性能特点**

  开漏输出：

  - 输出状态可控：通过控制信号可以切换输出状态。
  - 需要外部上拉电阻：以实现高电平输出。
  - 高电流吸收能力：在输出低电平时具有较强的电流吸收能力。
  - 适用于多路复用：可以与多个设备共享同一输出引脚。

  推挽输出：

  - 高输出电流能力：可以直接连接到电源和地，提供较高的输出电流。
  - 低功耗：在静态状态下只需要很小的工作电流。
  - 输出电压稳定：能提供稳定的高电平和低电平输出。
  - 高抗干扰能力：适用于驱动需要抗干扰能力较高的负载。

- **应用场景**

  开漏输出：

  - 当需要多个设备共享同一信号线时，开漏输出是一个很好的选择。它允许设备在不产生冲突的情况下轮流使用信号线，这在I2C、SPI等总线通信协议中尤为常见。
  - 适用于需要灵活电平控制的场合，如电平匹配、电流驱动等。
  - 当需要控制多个LED灯或其他低功耗负载时，开漏输出可以简化连接，因为它只需要一个外部上拉电阻来提供所需的电压。

  推挽输出：

  - 常用于数字电路中，如微控制器、单片机等电子设备的开关控制功能。
  - 在串口通信等点对点通信场景中，推挽输出通常是一个合适的选择，因为它可以提供稳定的输出电平，确保通信的可靠性。
  - 推挽输出具有较强的驱动能力，可以直接驱动较大的负载电流，因此适用于直接驱动继电器、电机等需要较高电流的负载。

### GPIO输入

上拉输入、下拉输入、模拟输入、浮空输入。

上拉和下拉接电阻的原因都是为了让引脚可控。试想一下，如果下列拉不接电阻直接接地，那么外部电压输入时直接把单片机引脚那段链路短路了，电流不会进入单片机引脚直接接地了。如果上拉不接电阻，那么单片机引脚一直是高电平，你外部怎么输入都改变不了单片机引脚状态。

# OLED显示屏调试

## 调试方法

- **串口调试**：通过串口通信，将调试信息发送到电脑端，电脑使用串口助手显示调试信息
- **显示屏调试**：直接将显示屏连接到单片机，将调试信息打印在显示屏上
- **Keil调试模式**：借助Keil软件的调试模式，可使用单步运行、设置断点、查看寄存器及变量等功能
- **注释法**
- **对照法**

## OLED简介

OLED（Organic Light Emitting Diode）：有机发光二极管

OLED显示屏：性能优异的新型显示屏，具有功耗低、相应速度快、宽视角、轻薄柔韧等特点

0.96寸OLED模块：小巧玲珑、占用接口少、简单易用，是电子设计中非常常见的显示屏模块

供电：3~5.5V，通信协议：I2C/SPI，分辨率：128*64

## OLED驱动



# 中断系统

## 中断定义

- **中断**：在主程序运行过程中，出现了特定的中断触发条件（中断源），使得CPU暂停当前正在运行的程序，转而去处理中断程序，处理完成后又返回原来被暂停的位置继续运行
- **中断优先级**：当有多个中断源同时申请中断时，CPU会根据中断源的轻重缓急进行裁决，优先响应更加紧急的中断源
- **中断嵌套**：当一个中断程序正在运行时，又有新的更高优先级的中断源申请中断，CPU再次暂停当前中断程序，转而去处理新的中断程序，处理完成后依次进行返回

## 中断执行流程

![image-20241022125509854](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241022125509854.png)

## STM32中断

- 68个可屏蔽中断通道，包含EXTI、TIM、ADC、USART、SPI、I2C、RTC等多个外设。
- 使用NVIC统一管理中断，每个中断通道都拥有16个可编程的优先等级，可对优先级进行分组，进一步设置抢占优先级和响应优先级。

## NVIC嵌套向量中断控制器![image-20241024115059163](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241024115059163.png)

- NVIC的中断优先级由优先级寄存器的4位（0~15）决定，这4位可以进行切分，分为高n位的抢占优先级和低4-n位的响应优先级。
- 抢占优先级高的可以中断嵌套，响应优先级高的可以优先排队，抢占优先级和响应优先级均相同的按中断号排队。

# GPIO外部中断

## 整体结构

![image-20241024123701173](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241024123701173.png)

## AFIO复用IO口

- AFIO主要用于引脚复用功能的选择和重定义。
- 在STM32中，AFIO主要完成两个任务：复用功能引脚重映射、中断引脚选择。![image-20241024123459351](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241024123459351.png)

## EXIT基本结构

![image-20241024123635410](C:\Users\z3254406361\AppData\Roaming\Typora\typora-user-images\image-20241024123635410.png)

## 编码步骤

1. 初始化GPIO引脚。
2. AFIO复用引脚为中断功能。
3. 配置EXIT寄存器，配置上升沿下降沿触发选择寄存器来选择上升沿还是下降沿触发中断，配置事件/中断屏蔽寄存器来使能或失能中断。
4. 配置NVIC，使能相应的中断通道，以及为整个系统的中断进行优先级分组并设置优先级。

# TIM中断

## TIM简介

- TIM（Timer）定时器
- 定时器可以对输入的时钟进行计数，并在计数值达到设定值时触发中断
- 16位计数器、预分频器、自动重装寄存器的时基单元，在72MHz计数时钟下可以实现最大59.65s的定时
- 不仅具备基本的定时中断功能，而且还包含内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等多种功能
- 根据复杂度和应用场景分为了高级定时器、通用定时器、基本定时器三种类型

# 中断总结

对于STM32的200多个中断分为68个中断通道全都要进入到NVIC里归NVIC中断控制器管理。对于外部中断EXIT的中断需要配置EXIT寄存器，因为GPIO引脚输入到单片机的只是高低电平上升沿下降沿，并非中断，而要通过EXIT来产生中断，而对于其他内部中断如定时器，USART等中断它们是能够直接产生中断的，故配置方法又是另外一种。总之，就是NVIC必须配置，其他的要根据其自己是否能产生中断，不能自己产生的则借助EXIT来产生中断。